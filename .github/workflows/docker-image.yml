name: Docker Image CI
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build the Docker image
        env:
          aliyun_username: ${{ secrets.ALIYUN_USERNAME }}
          aliyun_password: ${{ secrets.ALIYUN_PASSWORD }}
        run: |
          cat .env.example >> .env
          sudo docker login --username=${aliyun_username} registry.cn-chengdu.aliyuncs.com --password=${aliyun_password}
          sudo docker build -t api:latest .
          suto docker tag api:latest registry.cn-chengdu.aliyuncs.com/bookkeeping-01/api:latest
          sudo docker push registry.cn-chengdu.aliyuncs.com/bookkeeping-01/api:latest
